{{block "main" .}}
    <main>
        <div id="note" class="note">
            {{template "note-content" .}}
        </div>

        {{template "add-new-block" .}}
    </main>
{{end}}

{{define "new-note"}}
    <input
        id="title-editor"
        class="title-editor"
        name="title"
        autofocus
        hx-post="/notes"
        hx-target="#note"
        hx-trigger="blur, keydown[/Enter|Escape/.test(key)]"
    />
{{end}}

{{block "new-note-block-editor" .}}
    {{template "title" .}}
    {{template "block-editor" index .Blocks 0}}
    {{template "insert-preview-oob" .}}
{{end}}

{{block "note-content" .}}
    {{template "title" .}}
    {{template "blocks" .}}
{{end}}

{{block "title" .}}
    <h1
        id="title"
        class="title"
        hx-get="/notes/{{.ID}}/edit"
        hx-swap="outerHTML"
    >
        {{.Title}}
    </h1>
{{end}}

{{block "replace-title" .}}
    {{template "title" .}}
    {{template "preview-oob" .}}
{{end}}

{{block "title-editor" .}}
    <input
        id="title-editor"
        class="title-editor"
        name="title"
        autofocus
        onfocus="this.select();"
        hx-put="/notes/{{.ID}}"
        hx-swap="outerHTML"
        hx-trigger="blur, keydown[/Enter|Escape/.test(key)]"
        {{if .Title}}
            value="{{.Title}}"
        {{end}}
    />
{{end}}
