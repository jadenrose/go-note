{{block "blocks" .}}
    {{range .Blocks}}
        {{template "block-container" .}}
    {{end}}
{{end}}

{{block "block-container" .}}
    <div id="block-container-{{.ID}}" class="block-container">
        <div id="block-controls-{{.ID}}" class="block-controls">
            <button
                class="block-control"
                hx-confirm="Really delete this block? (Can't be undone)"
                hx-delete="/blocks/{{.ID}}"
                hx-target="#block-container-{{.ID}}"
                hx-swap="outerHTML"
            >
                {{template "icon-trash"}}
            </button>

            <button
                id="move-block-{{.ID}}"
                class="block-control"
                title="Move"
                hx-get="/blocks/{{.ID}}/move"
                hx-swap="afterend"
                hx-target="#block-container-{{.ID}}"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                >
                    <g fill="none">
                        <path
                            d="M24 0v24H0V0zM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"
                        />
                        <path
                            fill="currentColor"
                            d="M8.11 7.06a1.5 1.5 0 0 1 0-2.12l2.758-2.758a1.6 1.6 0 0 1 2.263 0l2.758 2.757a1.5 1.5 0 1 1-2.121 2.122l-.268-.268V10.5h3.707l-.268-.268a1.5 1.5 0 0 1 2.122-2.121l2.757 2.758a1.6 1.6 0 0 1 0 2.262l-2.757 2.758a1.5 1.5 0 0 1-2.122-2.121l.268-.268H13.5v3.707l.268-.268a1.5 1.5 0 0 1 2.121 2.122l-2.758 2.757a1.6 1.6 0 0 1-2.263 0l-2.757-2.757a1.5 1.5 0 0 1 2.121-2.122l.268.268V13.5H6.793l.268.268a1.5 1.5 0 1 1-2.122 2.121l-2.757-2.758a1.6 1.6 0 0 1 0-2.262L4.939 8.11a1.5 1.5 0 1 1 2.122 2.121l-.268.268H10.5V6.793l-.268.268a1.5 1.5 0 0 1-2.121 0Z"
                        />
                    </g>
                </svg>
            </button>
        </div>
        {{template "block" .}}
    </div>
{{end}}

{{block "block" .}}
    <p
        id="block-{{.ID}}"
        class="block"
        hx-get="/blocks/{{.ID}}/edit"
        hx-swap="outerHTML"
    >
        {{.Content}}
    </p>
{{end}}

{{block "block-editor--new" .}}
    <input
        id="block-editor"
        name="content"
        class="block-editor"
        hx-post="/blocks?note_id={{.NoteID}}"
        hx-trigger="blur, keydown[/Enter|Escape/.test(key)]"
        hx-swap="outerHTML"
        autofocus
    />
{{end}}

{{block "block-editor--existing" .}}
    <input
        id="block-editor"
        name="content"
        class="block-editor"
        hx-put="/blocks/{{.ID}}"
        hx-trigger="blur, keydown[/Enter|Escape/.test(key)]"
        hx-swap="outerHTML"
        autofocus
        value="{{.Content}}"
    />
{{end}}

{{block "block-editor--afterpost" .}}
    {{template "block-container" .}}
    {{template "block-editor--new" .}}
{{end}}

{{block "block-mover" .}}
    <div id="block-mover-{{.ID}}" class="block-mover">
        <button
            title="Cancel"
            class="block-mover-button standard-button"
            hx-get="/blocks/{{.ID}}/move/cancel"
            hx-target="#block-mover-{{.ID}}"
            hx-swap="delete"
        >
            {{template "icon-cancel"}}
        </button>
        <button
            title="Move Up"
            class="block-mover-button standard-button"
            hx-put="/blocks/{{.ID}}/move?direction=up"
            hx-target="#note"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
            >
                <g fill="none">
                    <path
                        d="M24 0v24H0V0zM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"
                    />
                    <path
                        fill="currentColor"
                        d="M13.06 3.283a1.5 1.5 0 0 0-2.12 0L5.281 8.939a1.5 1.5 0 0 0 2.122 2.122L10.5 7.965V19.5a1.5 1.5 0 0 0 3 0V7.965l3.096 3.096a1.5 1.5 0 1 0 2.122-2.122z"
                    />
                </g>
            </svg>
        </button>
        <button
            title="Move Down"
            class="block-mover-button standard-button"
            hx-put="/blocks/{{.ID}}/move?direction=down"
            hx-target="#note"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
            >
                <g fill="none">
                    <path
                        d="M24 0v24H0V0zM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"
                    />
                    <path
                        fill="currentColor"
                        d="M10.5 16.035L7.404 12.94a1.5 1.5 0 1 0-2.122 2.121l5.657 5.657a1.5 1.5 0 0 0 2.122 0l5.657-5.656a1.5 1.5 0 1 0-2.122-2.122L13.5 16.035V4.5a1.5 1.5 0 0 0-3 0z"
                    />
                </g>
            </svg>
        </button>
        <button
            title="Move to Top"
            class="block-mover-button standard-button"
            hx-put="/blocks/{{.ID}}/move?direction=top"
            hx-target="#note"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
            >
                <g fill="none">
                    <path
                        d="M24 0v24H0V0zM12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"
                    />
                    <path
                        fill="currentColor"
                        d="M19 5.5a1.5 1.5 0 0 0 0-3H5a1.5 1.5 0 1 0 0 3zM6.697 13.056a1.5 1.5 0 0 0 2.121 0l1.682-1.681V20a1.5 1.5 0 0 0 3 0v-8.626l1.682 1.682a1.5 1.5 0 1 0 2.121-2.121l-4.242-4.243a1.5 1.5 0 0 0-2.121 0l-4.243 4.243a1.5 1.5 0 0 0 0 2.121"
                    />
                </g>
            </svg>
        </button>
        <button
            title="Move to Bottom"
            class="block-mover-button standard-button"
            hx-put="/blocks/{{.ID}}/move?direction=bottom"
            hx-target="#note"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
            >
                <g fill="none">
                    <path
                        d="M24 0v24H0V0zM12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"
                    />
                    <path
                        fill="currentColor"
                        d="M5 18.5a1.5 1.5 0 0 0 0 3h14a1.5 1.5 0 0 0 0-3zm12.303-7.556a1.5 1.5 0 0 0-2.121 0L13.5 12.625V4a1.5 1.5 0 0 0-3 0v8.626l-1.682-1.682a1.5 1.5 0 1 0-2.122 2.121l4.243 4.243a1.5 1.5 0 0 0 2.121 0l4.243-4.243a1.5 1.5 0 0 0 0-2.121"
                    />
                </g>
            </svg>
        </button>
    </div>
{{end}}

{{block "add-new-block" .}}
    <div class="add-new-block">
        <button
            class="add-new-block-button standard-button"
            title="New Text Block"
            hx-get="/blocks/new?note_id={{.ID}}"
            hx-target="#note"
            hx-swap="beforeend"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
            >
                <g fill="none" fill-rule="evenodd">
                    <path
                        d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"
                    />
                    <path
                        fill="currentColor"
                        d="M4.5 5A1.5 1.5 0 0 1 6 3.5h12A1.5 1.5 0 0 1 19.5 5v2a1.5 1.5 0 0 1-3 0v-.5h-3v12h.5a1.5 1.5 0 0 1 0 3h-4a1.5 1.5 0 0 1 0-3h.5v-12h-3V7a1.5 1.5 0 1 1-3 0z"
                    />
                </g>
            </svg>
        </button>
        <span class="add-new-block-label">add a new block</span>
    </div>
{{end}}
